---
title: "Emergency Services Call Analysis in Buffalo, New York"
author: Sydney Deck
subtitle: Exploring the Correlation Between Mental Healthâ€“Related Emergency Calls and Median Household Income.
date: today
date-format: long
---

# Introduction

\[\ Emergency services are essential in times of crisis's, providing necessary response teams to areas in need with support from Police, Fire, and Medical professionals. Unfortunately high call volumes and low staffing can result in misguided directives and improper handling of sensitive situations. This report will provide further insight on call classification and distribution of mental health related calls within the City of Buffalo, including any potential correlation between median household income. The results of this analysis will assist in understanding the use of Buffalo's resources and how socio-economic factors can be indicative of ...    \]

# Materials and methods

\[\~ 200 words\]

Overview: Import, clean and categorize required data from March and April of 2024 into Mental Health categories. Plot call types and call volumes. Run a regression analysis on specified mental health call types and median income values. 

Data required for this analysis: 
  - 911 call data provided by the City of Buffalo Police Department for the months of March and April in 2024. Data can be found at 'https://figshare.com/articles/dataset/Buffalo_911_Call_March_and_April_2024/30585986?file=59454170'
  - Census tract data from 'https://www.census.gov/data/' using an API key from 2023, the most recent and compatible dataset.     Must include median income data and total populaton data. 
  - Zipcode boundaries from 'https://data.buffalony.gov/' using an API key. 

Necessary steps:
  1. Import necessary libraries and datasets for use. 
  2. Clean up imported data and complete pre-processing requirements.
  3. Define mental health categories and assign them to the call data.
  4. Create a summary table of call types and locations. 
  5. Plot a bar chart summary of call frequency 
  6. Map most frequent call types by zipcode
  7. Map call volume by zip code
  8. Create and run a regression model on call frequency versus median income. 
  9. Plot and analyze regression. 

```{r}
## Step 1

install.packages(c("tigris", "sf"))
install.packages("tidycensus", dependencies = TRUE)

library(dplyr)
library(readr)
library(sf)
library(ggplot2)
library(tigris)
library(tidycensus)
library(leaflet)
library(htmltools)
library(tidyr)

# Import 911 data CSV from github data folder
data_911_url <- "https://raw.githubusercontent.com/sjdeck/geo511/refs/heads/master/data/mar2apr2024_latlong.csv"
data_911 <- read_csv(data_911_url)

# Import zipcode data from API 
url_json <- "https://data.buffalony.gov/resource/qnyw-efar.geojson"
zipcode_json <- st_read(url_json, quiet = TRUE)

# Import Census data through API 
# Set API key
census_api_key("e12a911e4853b9b6ae9944d643816d70cd2b9b18", install = TRUE)
readRenviron("~/.Renviron") 

# Download tract data 
erie_tracts <- tracts(
  state = "NY",
  county = "Erie",
  year = 2023,   # most recent ACS-compatible year
  cb = TRUE      # "cartographic boundary" = simplified shapes
)

census_data <- get_acs(
  geography = "tract",
  state = "NY",
  county = "Erie",
  year = 2023,
  variables = c(
    median_income = "B19013_001",   # Median household income
    total_pop     = "B01003_001"    # Total population
  ),
  geometry = TRUE                    # include spatial shapes
)

```

Refer to output in your narrative like this: x=`r x` .

Load any required packages in a code chunk (you may need to install some packages):

```{r, message=F, warning=F}
library(tidyverse)
library(leaflet)
library(kableExtra)
library(htmlwidgets)
library(widgetframe)
knitr::opts_chunk$set(widgetframe_widgets_dir = 'widgets' ) 
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling
```

## Download and clean all required data

```{r}
n=20
data=data.frame(x=runif(n,-180,180),
                y=runif(n,-60,60),
                size = runif(n, 5, 20),
                category = factor(
                  sample(letters[1:5], n, replace = TRUE)
                  ),
                value = rnorm(n))
```

```{r, results='asis'}
data %>% 
  slice(1:10) %>% #show only 1:n rows
  kable(digits=2,align="c")%>% #make table and round to two digits
  kable_styling(bootstrap_options = 
                  c("striped", "hover", "condensed", "responsive")) #apply other formatting
```

Add any additional processing steps here.

# Results

\[\~200 words\]

Tables and figures (maps and other graphics) are carefully planned to convey the results of your analysis. Intense exploration and evidence of many trials and failures. The author looked at the data in many different ways before coming to the final presentation of the data.

Show tables, plots, etc. and describe them.

```{r, fig.width=6, fig.height=3, fig.cap="Map of completely random data"}
m <- leaflet(data) %>% 
  addTiles() %>% 
  addCircleMarkers(~x, ~y, radius = ~size,color = ~as.factor(category)) %>% 
  addPopups(~x[2], ~y[2], "Random popup")
m  # a map with the default OSM tile layer
```

```{r}
data %>% 
  ggplot(aes(x=x,y=y,col=category))+
  geom_point()
```

### Dygraphs Example

```{r}
library(dygraphs)
dygraph(nhtemp, main = "New Haven Temperatures") |> 
  dyRangeSelector(dateWindow = c("1920-01-01", "1960-01-01")) 
```

# Conclusions

\[\~200 words\]

Clear summary adequately describing the results and putting them in context. Discussion of further questions and ways to continue investigation.

# References

All sources are cited in a consistent manner
