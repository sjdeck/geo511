---
title: "Emergency Services Call Analysis in Buffalo, New York"
author: Sydney Deck
subtitle: Exploring the Correlation Between Mental Healthâ€“Related Emergency Calls and Median Household Income.
date: today
date-format: long
---

# Introduction

\[\ Emergency services are essential in times of crisis's, providing necessary response teams to areas in need with support from Police, Fire, and Medical professionals. Unfortunately high call volumes and low staffing can result in misguided directives and improper handling of sensitive situations. This report will provide further insight on call classification and distribution of mental health related calls within the City of Buffalo, including any potential correlation between median household income. The results of this analysis will assist in understanding the use of Buffalo's resources and how socio-economic factors can be indicative of ...    \]

# Materials and methods

\[\~ 200 words\]

Overview: Import, clean and categorize required data from March and April of 2024 into Mental Health categories. Plot call types and call volumes. Run a regression analysis on specified mental health call types and median income values. 

Data required for this analysis: 
  - 911 call data provided by the City of Buffalo Police Department for the months of March and April in 2024. Data can be found at 'https://figshare.com/articles/dataset/Buffalo_911_Call_March_and_April_2024/30585986?file=59454170'
  - Census tract data from 'https://www.census.gov/data/' using an API key from 2023, the most recent and compatible dataset.     Must include median income data and total populaton data. 
  - Zipcode boundaries from 'https://data.buffalony.gov/' using an API key. 

Necessary steps:
  1. Import necessary libraries and datasets for use. 
  2. Clean up imported data and complete pre-processing requirements.
  3. Define mental health categories and assign them to the call data.
  4. Create a summary table of call types and locations. 
  5. Plot a bar chart summary of call frequency 
  6. Map most frequent call types by zipcode
  7. Map call volume by zip code
  8. Create and run a regression model on call frequency versus median income. 
  9. Plot regression. 

Step 1: 
Load any required packages:

```{r, message=F, warning=F}

#install.packages(c("tigris", "sf"))
#install.packages("tidycensus", dependencies = TRUE)

library(dplyr)
library(readr)
library(sf)
library(ggplot2)
library(tigris)
library(tidycensus)
library(leaflet)
library(htmltools)
library(tidyr)
```

## Data

```{r}

# Import 911 data CSV from github data folder
data_911_url <- "https://raw.githubusercontent.com/sjdeck/geo511/refs/heads/master/data/mar2apr2024_latlong.csv"
data_911 <- read_csv(data_911_url)

# Import zipcode data from API 
url_json <- "https://data.buffalony.gov/resource/qnyw-efar.geojson"
zipcode_json <- st_read(url_json, quiet = TRUE)

# Import Census data through API 
# Set API key
census_api_key("e12a911e4853b9b6ae9944d643816d70cd2b9b18", install = TRUE, overwrite = TRUE)
readRenviron("~/.Renviron") 

# Download tract data 
erie_tracts <- tracts(
  state = "NY",
  county = "Erie",
  year = 2023,   # most recent ACS-compatible year
  cb = TRUE      # "cartographic boundary" = simplified shapes
)

census_data <- get_acs(
  geography = "tract",
  state = "NY",
  county = "Erie",
  year = 2023,
  variables = c(
    median_income = "B19013_001",   # Median household income
    total_pop     = "B01003_001"    # Total population
  ),
  geometry = TRUE                    # include spatial shapes
)

```

Step 2: 
# Clean & Convert 911 data 

```{r, results='asis'}

# Convert to an sf object to "enable standard spatial data handling, analysis, and visualization"
calls_sf <- st_as_sf(data_911, coords = c("Longitude", "Latitude"), crs = 4326, remove = FALSE)


```

Step 3:

# Define Mental Health Categories and assign them to the call data

```{r, results='asis'}
# Categories given by PPG Buffalo 

mental_health_desc <- c("LOUD NOISE", "NEIGHBOR TROUBLE","TRESPASSING","CUSTOMER TROUBLE",
"DOMESTIC TROUBLE","CHECK WELFARE","UNWELCOME GUEST","DRUNK","NARCOTICS","MISCELLANEOUS",
"ASSIST CITIZEN","PERSON SOLICITING", "JUVENILE TROUBLE","PROPERTY DISPUTE","MOTORIST STRANDED","LANDLORD TROUBLE","SUICIDE ATTEMPT","PERSON DOWN","PERSON SCREAMING","JUVENILE FOUND","INDECENT EXPOSURE","LABOR DISPUTE","PROSTITUTION","GAMBLING" )

# Create a new dataset with only mental health descriptors
mental_health_data <- calls_sf %>%
  filter( DESCRIPTIO %in% mental_health_desc ) %>%
  rename(
    description = DESCRIPTIO,
    date = DATEREPORT,
    full_address = Buff_remov,
    street_name = STRNAME
  )

# Preview of data
head(mental_health_data)


```

Step 4:

# Create a summary table of the call data. 

```{r, results='asis'}
# Count each unique number and order by frequency
summary_table <- mental_health_data %>%
  count(description, sort = FALSE) %>%   # counts and sorts descending by n
  rename(Frequency = n)
```

Step 5:

# Plot a bar chart summary of call frequency 

```{r, results='asis'}

```

Step 6:

# Map most frequent call types by zipcode 

```{r, results='asis'}

```

Step 7:

# Map call volume by zip code

```{r, results='asis'}

```

Step 8:

# Create and run a regression model on call frequency versus median income

```{r, results='asis'}

```

Step 9:

# Plot Regression

```{r, results='asis'}

```


# Results

\[\~200 words\]

Tables and figures (maps and other graphics) are carefully planned to convey the results of your analysis. Intense exploration and evidence of many trials and failures. The author looked at the data in many different ways before coming to the final presentation of the data.

Show tables, plots, etc. and describe them.

```{r, fig.width=6, fig.height=3, fig.cap="Map of completely random data"}

```

```{r}

```

### Dygraphs Example

```{r}

```

# Conclusions

\[\~200 words\]

Clear summary adequately describing the results and putting them in context. Discussion of further questions and ways to continue investigation.

# References

All sources are cited in a consistent manner
